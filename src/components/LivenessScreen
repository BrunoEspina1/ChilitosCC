import { useEffect, useState } from "react";
import { FaceLivenessDetector } from "@aws-amplify/ui-react";

export default function LivenessScreen({ onSuccess }) {
  const [session, setSession] = useState(null);

  // 1. Pedir SessionId a la API REST
  useEffect(() => {
    fetch("/liveness/session")                   // Amplify añadirá el dominio/API
      .then(res => res.json())
      .then(setSession)
      .catch(console.error);
  }, []);

  if (!session) return <p>Cargando…</p>;

  return (
    <FaceLivenessDetector
      sessionId={session.sessionId}
      region={session.region}
      onAnalysisComplete={({ confidence }) => {
        if (confidence > 0.95) onSuccess();      // umbral flexible
        else alert("No se pudo verificar presencia real 🙁");
      }}
    />
  );
}
